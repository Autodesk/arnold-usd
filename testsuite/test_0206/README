Fix random results with instances & reference files using complex composition arcs

see #1021

author: sebastien ortega

